var c=Object.defineProperty;var d=(n,r,s)=>r in n?c(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s;var t=(n,r,s)=>d(n,typeof r!="symbol"?r+"":r,s);import{d as h,b as u,e as p,c as v,o as C,_ as M}from"./index-RKBFIPWT.js";const w="/vue/assets/smoke-DA8PfHk-.png",S={id:"map",style:{width:"100%"}},f=h({__name:"cesium5",setup(n){Cesium.buildModuleUrl.setBaseUrl("/node_modules/cesium/Build/Cesium/"),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3ZjQ5ZGUzNC1jNWYwLTQ1ZTMtYmNjYS05YTY4ZTVmN2I2MDkiLCJpZCI6MTE3MTM4LCJpYXQiOjE2NzY0NDUyODB9.ZaNSBIfc1sGLhQd_xqhiSsc0yr8oS0wt1hAo9gbke6M";class r{constructor(e,i){t(this,"viewer");t(this,"viewModel");t(this,"emitterModelMatrix");t(this,"translation");t(this,"rotation");t(this,"hpr");t(this,"trs");t(this,"scene");t(this,"particleSystem");t(this,"entity");this.viewer=e,this.viewModel={emissionRate:5,gravity:0,minimumParticleLife:1,maximumParticleLife:6,minimumSpeed:1,maximumSpeed:4,startScale:0,endScale:10,particleSize:25},this.emitterModelMatrix=new Cesium.Matrix4,this.translation=new Cesium.Cartesian3,this.rotation=new Cesium.Quaternion,this.hpr=new Cesium.HeadingPitchRoll,this.trs=new Cesium.TranslationRotationScale,this.scene=this.viewer.scene,this.particleSystem="",this.entity=this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(i.lng,i.lat,100)}),this.init()}init(){const e=this;this.viewer.clock.shouldAnimate=!0,this.viewer.scene.globe.depthTestAgainstTerrain=!1;const i=this.scene.primitives.add(new Cesium.ParticleSystem({image:w,startColor:Cesium.Color.BLACK.withAlpha(.7),endColor:Cesium.Color.WHITE.withAlpha(.3),startScale:e.viewModel.startScale,endScale:e.viewModel.endScale,minimumParticleLife:e.viewModel.minimumParticleLife,maximumParticleLife:e.viewModel.maximumParticleLife,minimumSpeed:e.viewModel.minimumSpeed,maximumSpeed:e.viewModel.maximumSpeed,imageSize:new Cesium.Cartesian2(e.viewModel.particleSize,e.viewModel.particleSize),emissionRate:e.viewModel.emissionRate,lifetime:16,sizeInMeters:!0,emitter:new Cesium.CircleEmitter(2),updateCallback:(a,m)=>this.applyGravity(a,m)}));this.particleSystem=i,this.preUpdateEvent()}preUpdateEvent(){const e=this;this.viewer.scene.preUpdate.addEventListener(function(i,a){e.particleSystem.modelMatrix=e.computeModelMatrix(e.entity,a),e.particleSystem.emitterModelMatrix=e.computeEmitterModelMatrix(),e.viewModel.spin&&(e.viewModel.heading+=1,e.viewModel.pitch+=1,e.viewModel.roll+=1)})}computeModelMatrix(e,i){return e.computeModelMatrix(i,new Cesium.Matrix4)}computeEmitterModelMatrix(){return this.hpr=Cesium.HeadingPitchRoll.fromDegrees(0,0,0,this.hpr),this.trs.translation=Cesium.Cartesian3.fromElements(-4,0,1.4,this.translation),this.trs.rotation=Cesium.Quaternion.fromHeadingPitchRoll(this.hpr,this.rotation),Cesium.Matrix4.fromTranslationRotationScale(this.trs,this.emitterModelMatrix)}applyGravity(e,i){const a=new Cesium.Cartesian3,m=e.position;Cesium.Cartesian3.normalize(m,a),Cesium.Cartesian3.fromElements(20*i,30*i,a.y*i,a),e.velocity=Cesium.Cartesian3.add(e.velocity,a,e.velocity)}removeEvent(){this.viewer.scene.preUpdate.removeEventListener(this.preUpdateEvent,this),this.emitterModelMatrix=void 0,this.translation=void 0,this.rotation=void 0,this.hpr=void 0,this.trs=void 0}remove(){this.removeEvent(),this.viewer.scene.primitives.remove(this.particleSystem),this.viewer.entities.remove(this.entity)}}let s,o;return u(()=>{s=new Cesium.Viewer("map",{}),s.scene.debugShowFramesPerSecond=!0,s.scene.globe.depthTestAgainstTerrain=!0,o=new r(s,{lng:-117.16,lat:32.71}),s.camera.setView({destination:Cesium.Cartesian3.fromDegrees(-117.16,32.71,1500)})}),p(()=>{o&&o.remove()}),(l,e)=>(C(),v("div",S))}}),g=M(f,[["__scopeId","data-v-1c23987f"]]);export{g as default};
